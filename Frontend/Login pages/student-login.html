<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Login</title>
  <link rel="stylesheet" href="student-style.css">
</head>

<body>
  <header>
    <img src="Niat-icon.png" alt="Niat logo" width="50">
    <h1>Niat Hostel</h1>
  </header>

  <main>
    <section>
      <h1>Welcome Student!</h1>
      <p>Raise complaints and track your issues here.</p>
    </section>

    <form id="loginForm">
      <label for="identifier"></label>
      <input id="identifier" type="text" placeholder="Email / Student Id" required>


      <label for="password"></label>
      <input id="password" type="password" placeholder="Password" required>
      <br>

      <button type="submit">Login</button>
    </form>

    <br>
    <p>Don't have an account? <span class="spanelement">Contact Admin</span></p>
  </main>

  <footer>
    <p>@Niat Hostel 2025 | Contact: hostel@niat.edu</p>
  </footer>

  <script>
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const loginData = {
        identifier: document.getElementById("identifier").value,
        password: document.getElementById("password").value,
      };
      // Build a correct backend URL — the API route is exposed as /StudentLogin on the
      // backend, not under the static file path. If this page is served from a
      // preview host (app.github.dev) or opened via file://, use the BACKEND
      // forwarded URL instead.
      const BACKEND = "http://localhost:3000"; // replace with your forwarded public URL when needed
      // Use the page origin when possible (this covers the backend origin *and*
      // Codespaces forwarded host like `*.app.github.dev`). Only fall back to
      // BACKEND when the page is opened locally via file:// (browser cannot
      // reach the container's localhost).
      const base = (location.protocol === "file:") ? BACKEND : location.origin;
      const url = `${base}/StudentLogin`;

      let res;
      try {
        res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(loginData),
        });
      } catch (networkErr) {
        console.error("Network error when calling", url, networkErr);
        alert(`❌ Unable to reach server at ${url}. Is the backend running and publicly forwarded?`);
        return;
      }

      let data = {};
      const contentType = res.headers.get("content-type") || "";
      if (contentType.includes("application/json")) {
        try {
          data = await res.json();
        } catch (err) {
          // Malformed or empty JSON — fall back to status text
          data = { message: res.statusText || "No response body" };
        }
      } else {
        // Non-JSON response (or empty) — provide a friendly message
        data = { message: res.statusText || "No response body" };
      }

      if (res.ok) {
        alert("✅ Login successful!");
        setTimeout(() => {
          window.location.href = "dashboard.html";
        }, 1000);
      } else {
        alert("❌ " + (data.message || `Request failed (${res.status})`));
      }
    });
  </script>
</body>

</html>